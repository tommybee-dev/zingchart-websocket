<html>
<head>
	<!-- <meta charset="utf-8"> -->
	<meta http-equiv='Content-Type' content='Type=text/html; charset=euc-kr'>
  <!--Script Reference[1]-->
  <!--<script src='http://cdn.zingchart.com/zingchart.min.js'></script>-->
  <script src='zingchart_branded_version/zingchart.min.js' charset="utf-8"></script>
   <script>
    zingchart.MODULESDIR = "https://cdn.zingchart.com/modules/";
    ZC.LICENSE = ["569d52cefae586f634c54f86dc99e6a9", "ee6b7db5b51705a13dc2339db3edaf6d"];
  </script>
  <style>
    html,
    body {
      height: 100%;
      width: 100%;
      margin: 0;
      padding: 0;
    }
    
    .zc-ref {
      display: none;
    }
  </style>
</head>

<body  onLoad="renderGraph();renderGauge();">
	<div id='myChart' style="height:70%; width:100%; background:#000000"></div>
	<div id='myGauge' style="height:30%; width:100%; background:#000000"><a class="zc-ref" href="#">Powered by ZingChart</a></div>
 
  <script>
  	function renderGauge()
  	{
  		var myConfig = {
		      backgroundColor: "#fff",
		      globals: {
		        color: "#666"
		      },
		      graphset: [{
		        type: "gauge",
		        x: 0,
		        y: 0,
		        width: "31.5%",
		        height: "100%",
		        "media-rules": [{
		          "max-width": 650,
		          "x": 0,
		          "y": "2%",
		          "width": '100%',
		          "height": "20%",
		        }, {
		          "min-width": 651,
		          x: 0,
		          y: 0,
		          width: "31.5%",
		          height: "100%",
		        }],
		        title: {
		          text: "Value",
		          "media-rules": [{
		            "max-width": 650,
		            "visible": false
		          }]
		        },
		        scaleR: {
		          aperture: 130,
		          values: "0:60:10",
		          guide: {
		            backgroundColor: "#E3DEDA",
		            alpha: 1
		          },
		          ring: {
		            backgroundColor: "#E3DEDA",
		            "media-rules": [{
		              "max-width": 650,
		              "visible": false
		            }]
		          },
		          center: {
		            size: 20,
		            borderWidth: 2,
		            borderColor: "#23211E",
		            "media-rules": [{
		              "max-width": 650,
		              "size": 10
		            }]
		          },
		          item: {
		            offsetR: 0
		          },
		          tick: {
		            visible: false
		          },
		          markers: [{
		            type: "area",
		            range: [0, 35],
		            backgroundColor: "#D31E1E",
		            alpha: .95,
		          }]
		        },
		        plotarea: {
		          marginTop: "35%"
		        },
		        plot: {
		          csize: "3%",
		          size: "100%"
		        },
		        scale: {
		          sizeFactor: 1.2,
		          "media-rules": [{
		            "max-width": 650,
		            sizeFactor: 1.6,
		          }]
		        },
		        tooltip: {
		          visible: false
		        },
		        series: [{
		          values: [35],
		          backgroundColor: "#23211E",
		          valueBox: {
		            text: "%v",
		            placement: "center",
		            fontColor: "#D31E1E",
		            fontSize: 14,
		            "media-rules": [{
		              "max-width": 650,
		              "fontSize": 10
		            }]
		          }
		        }]
		      }, {
		        type: "gauge",
		        x: "34.5%",
		        y: 0,
		        width: "31.5%",
		        height: "100%",
		        "media-rules": [{
		          "max-width": 650,
		          "x": 0,
		          "y": "20%",
		          "width": '100%',
		          "height": "20%",
		        }, {
		          "min-width": 651,
		          x: "34.5%",
		          y: 0,
		          width: "31.5%",
		          height: "100%",
		        }],
		        title: {
		          text: "실측치2",
		          "media-rules": [{
		            "max-width": 650,
		            "visible": false
		          }]
		        },
		        scaleR: {
		          aperture: 130,
		          values: "0:60:10",
		          guide: {
		            backgroundColor: "#E3DEDA",
		            alpha: 1
		          },
		          ring: {
		            backgroundColor: "#E3DEDA",
		            "media-rules": [{
		              "max-width": 650,
		              "visible": false
		            }]
		          },
		          center: {
		            size: 20,
		            borderWidth: 2,
		            borderColor: "#23211E",
		            "media-rules": [{
		              "max-width": 650,
		              "size": 10
		            }]
		          },
		          item: {
		            offsetR: 0
		          },
		          tick: {
		            visible: false
		          },
		          markers: [{
		            type: "area",
		            range: [0, 11],
		            backgroundColor: "#7CA82B",
		            alpha: .95,
		          }]
		        },
		        plotarea: {
		          marginTop: "35%"
		        },
		        plot: {
		          csize: "3%",
		          size: "100%"
		        },
		        scale: {
		          sizeFactor: 1.2,
		          "media-rules": [{
		            "max-width": 650,
		            sizeFactor: 1.6,
		          }]
		        },
		        tooltip: {
		          visible: false
		        },
		        series: [{
		          values: [11],
		          backgroundColor: "#23211E",
		          valueBox: {
		            text: "%v",
		            placement: "center",
		            fontColor: "#7CA82B",
		            fontSize: 14,
		            "media-rules": [{
		              "max-width": 650,
		              "fontSize": 10
		            }]
		          }
		        }]
		      }, {
		        type: "gauge",
		        x: "69%",
		        y: 0,
		        width: "31.5%",
		        height: "100%",
		        "media-rules": [{
		          "max-width": 650,
		          "x": 0,
		          "y": "40%",
		          "width": '100%',
		          "height": "20%",
		        }, {
		          "min-width": 651,
		          "x": "69%",
		          "y": 0,
		          "width": "31.5%",
		          "height": "100%",
		        }],
		        title: {
		          text: "실측치2",
		          "media-rules": [{
		            "max-width": 650,
		            "visible": false
		          }]
		        },
		        scaleR: {
		          aperture: 130,
		          values: "0:60:10",
		          guide: {
		            backgroundColor: "#E3DEDA",
		            alpha: 1
		          },
		          ring: {
		            backgroundColor: "#E3DEDA",
		            "media-rules": [{
		              "max-width": 650,
		              "visible": false
		            }]
		          },
		          center: {
		            size: 20,
		            borderWidth: 2,
		            borderColor: "#23211E",
		            "media-rules": [{
		              "max-width": 650,
		              "size": 10
		            }]
		          },
		          item: {
		            offsetR: 0
		          },
		          tick: {
		            visible: false
		          },
		          markers: [{
		            type: "area",
		            range: [0, 28],
		            backgroundColor: "#EF8535",
		            alpha: .95,
		          }]
		        },
		        plotarea: {
		          marginTop: "35%"
		        },
		        plot: {
		          csize: "3%",
		          size: "100%"
		        },
		        scale: {
		          sizeFactor: 1.2,
		          "media-rules": [{
		            "max-width": 650,
		            sizeFactor: 1.6,
		          }]
		        },
		        tooltip: {
		          visible: false
		        },
		        series: [{
		          values: [28],
		          backgroundColor: "#23211E",
		          valueBox: {
		            text: "%v",
		            placement: "center",
		            fontColor: "#EF8535",
		            fontSize: 14,
		            "media-rules": [{
		              "max-width": 650,
		              "fontSize": 10
		            }]
		          }
		        }]
		      }]
		    };
		
		    zingchart.render({
		      id: 'myGauge',
		      data: myConfig,
		      height: "100%",
		      width: '100%'
		    });
		
		    /*
		     * SetInterval is used to simulate live input. We also have
		     * a feed attribute that takes in http requests, websockets,
		     * and return value from a JS function.
		     
		    setInterval(function() {
		      var colors = ['#D31E1E', '#7CA82B', '#EF8535'];
		      var Marker = function(bgColor, ceiling) {
		        return {
		          type: "area",
		          range: [0, ceiling],
		          backgroundColor: bgColor,
		          alpha: .95,
		        }
		      };
		      var randomOffset0 = [-5, 5, 3, -3, 2, -2];
		      var randomOffset1 = [10, -10, -5, 5, 3, -3, 2, -2, 7, -7];
		      var output0 = Math.ceil(33 + randomOffset0[Math.floor(Math.random() * 6)]);
		      var output1 = Math.ceil(11 + randomOffset0[Math.floor(Math.random() * 6)]);
		      var output2 = Math.ceil(22 + randomOffset1[Math.floor(Math.random() * 9)]);
		
		      // 1) update gauge values
		      zingchart.exec('myGauge', 'appendseriesdata', {
		        graphid: 0,
		        plotindex: 0,
		        update: false,
		        data: {
		          values: [output0]
		        }
		      });
		      zingchart.exec('myGauge', 'appendseriesdata', {
		        graphid: 1,
		        plotindex: 0,
		        update: false,
		        data: {
		          values: [output1]
		        }
		      });
		      zingchart.exec('myGauge', 'appendseriesdata', {
		        graphid: 2,
		        plotindex: 0,
		        update: false,
		        data: {
		          values: [output2]
		        }
		      });
		
		      // 2) update guage markers
		      zingchart.exec('myGauge', 'modify', {
		        graphid: 0,
		        update: false,
		        data: {
		          scaleR: {
		            markers: [
		              Marker(colors[0], output0)
		            ]
		          }
		        }
		      });
		      zingchart.exec('myGauge', 'modify', {
		        graphid: 1,
		        update: false,
		        data: {
		          scaleR: {
		            markers: [
		              Marker(colors[1], output1)
		            ]
		          }
		        }
		      });
		      zingchart.exec('myGauge', 'modify', {
		        graphid: 2,
		        update: false,
		        data: {
		          scaleR: {
		            markers: [
		              Marker(colors[2], output2)
		            ]
		          }
		        }
		      });
		
		      // batch update all chart modifications
		      zingchart.exec('myGauge', 'update');
		
		    }, 1500);
		    */
  	}
  	function setGaugeValue(num1,num2,num3)
  	{
		var colors = ['#D31E1E', '#7CA82B', '#EF8535'];
		var Marker = function(bgColor, ceiling) {
			return {
			  type: "area",
			  range: [0, ceiling],
			  backgroundColor: bgColor,
			  alpha: .95,
			}
		};
		//var randomOffset0 = [-5, 5, 3, -3, 2, -2];
		//var randomOffset1 = [10, -10, -5, 5, 3, -3, 2, -2, 7, -7];
		//var output0 = Math.ceil(33 + randomOffset0[Math.floor(Math.random() * 6)]);
		//var output1 = Math.ceil(11 + randomOffset0[Math.floor(Math.random() * 6)]);
		//var output2 = Math.ceil(22 + randomOffset1[Math.floor(Math.random() * 9)]);

		// 1) update gauge values
		zingchart.exec('myGauge', 'appendseriesdata', {
			graphid: 0,
			plotindex: 0,
			update: false,
				data: {
				values: [num1]
			}
		});
		zingchart.exec('myGauge', 'appendseriesdata', {
			graphid: 1,
			plotindex: 0,
			update: false,
			data: {
				values: [num2]
			}
		});
			zingchart.exec('myGauge', 'appendseriesdata', {
			graphid: 2,
			plotindex: 0,
			update: false,
			data: {
				values: [num3]
			}
		});

		// 2) update guage markers
		zingchart.exec('myGauge', 'modify', {
			graphid: 0,
			update: false,
			data: {
				scaleR: {
					markers: [
						Marker(colors[0], num1)
					]
				}
			}
		});
		zingchart.exec('myGauge', 'modify', {
			graphid: 1,
			update: false,
			data: {
				scaleR: {
					markers: [
						Marker(colors[1], num2)
					]
				}
			}
		});
		zingchart.exec('myGauge', 'modify', {
			graphid: 2,
			update: false,
			data: {
				scaleR: {
					markers: [
						Marker(colors[2], num3)
					]
				}
			}
		});

		// batch update all chart modifications
		zingchart.exec('myGauge', 'update');

  	}
  	function renderGraph()
	{
		var myConfig = {
	      gui: {
	        contextMenu: {
	          position: 'right',
	          docked: true,
	          alpha: 0.9,
	          item: {
	            textAlpha: 1
	          },
	          button: {
	            visible: true
	          }
	        }
	      },
	      graphset: [{
	        type: 'line',
	        borderColor: "#cccccc",
	        borderWidth: 1,
	        borderRadius: 2,
	        plot: {
	          aspect: 'spline'
	        },
	        plotarea: {
	          margin: 'dynamic'
	        },
	        utc: true,
	        timezone: 9,
	        title: {
	          text: 'Demo',
	          adjustLayout: true,
	          align: 'left',
	          marginLeft: '15%'
	        },
	        legend: {
	          draggable: true,
	          backgroundColor: 'transparent',
	          header: {
	            text: "Legend",
	            backgroundColor: '#f0f0f0'
	          },
	          marker: {
	            visible: false
	          },
	          Item: {
	            margin: '5 17 2 0',
	            padding: '3 3 3 3',
	            fontColor: '#fff',
	            cursor: 'hand'
	          },
	          verticalAlign: 'middle',
	          borderWidth: 0
	        },
	        scaleX: {
	          //minValue: 1484870400000, //set minValue timestamp
	          //minValue: 1512018819470,
	          //step: 'day', //set step for scale
	          //step: '30minute',
	          step: 'second',
	          maxItems: 7,
	          itemsOverlap: true,
	          zooming: true,
	          transform: {
	            type: 'date',
	            all: "%d %M %Y<br>%g:%i:%s"
	          }
	        },
	        preview: {
	          adjustLayout: true,
	          live: true
	        },
	        scaleY: {
	          step: 10,
	          format: '%v°C',
	          label: {
	            text: 'Title'
	          },
	          guide: {
	            lineStyle: 'solid'
	          }
	        },
	        crosshairX: {
	          lineColor: '#555',
	          alpha: .3,
	          plotLabel: {
	            //backgroundColor: '#fff',
	            backgroundColor: '#e0e0e0',
	            multiple: true,
	            borderWidth: 2,
	            borderRadius: 2,
	            text: '<span style="color:%color">%v°</span>'
	          },
	          marker: {
	            size: 5,
	            borderWidth: 1,
	            borderColor: '#fff'
	          }
	        },
	        tooltip: {
	          visible: false
	        },
	        series: [{
	          values: [],
	          text: 'Value',
	          legendItem: {
	            backgroundColor: '#29A2CC',
	            borderRadius: 2
	          }
	        }, {
	          values: [],
	          text: 'Value2',
	          legendItem: {
	            backgroundColor: '#D31E1E',
	            borderRadius: 2
	          }
	        }, {
	          values: [],
	          text: 'Value3',
	          legendItem: {
	            backgroundColor: '#7CA82B',
	            borderRadius: 2
	          }
	        }, {
	          values: [],
	          text: 'Value4',
	          legendItem: {
	            backgroundColor: '#EF8535',
	            borderRadius: 2
	          }
	        }]
	      }]
	    };
	
	    zingchart.render({
	      id: 'myChart',
	      data: myConfig,
	      height: '100%',
	      width: '100%'
	    });
	    
	    //Set up of a websocket
		//var ws = new WebSocket('ws://65.50.232.201:8888/', 'zingchart');
		//var ws = new WebSocket('ws://localhost:8080/examples/websocket/chartProgrammatic');
		//alert(window.location.host);
		var ws = new WebSocket('ws://'+ window.location.host +'/examples/websocket/sychart');
		
		
		//Tell our internal server what to send.
		ws.onopen = function(){
			ws.send('zingchart.feed');
		    ws.send('zingchart.push');
		    ws.send('zingchart.getdata');
		}
		
		//Setup an event to call a ZingChart API Method to update our chart.
		ws.onmessage = function (e) {
			//console.log("===== \n " + JSON.stringify(e.data));
			//console.log("===== \n ");
			//var data = JSON.parse(e.data);
			var data = JSON.parse(e.data);
		    var newValue = data['plot0'][1];
		    var time = data['plot0'][0];
			    
		    //console.log("====> " + time);
			//console.log("====> " + newValue);
			
			zingchart.exec('myChart', 'appendseriesvalues', {
			  plotindex : 0,
			  values : [[time,newValue]]
			});
			  
			var newValue2 = data['plot1'][1];
			var time2 = data['plot1'][0];
			
			zingchart.exec('myChart', 'appendseriesvalues', {
			  plotindex : 1,
			  values : [[time2,newValue2]]
			});
			
			var newValue3 = data['plot2'][1];
			var time3 = data['plot2'][0];
			
			zingchart.exec('myChart', 'appendseriesvalues', {
			  plotindex : 2,
			  values : [[time3,newValue3]]
			});
			
			var newValue4 = data['plot3'][1];
			var time4 = data['plot3'][0];
			zingchart.exec('myChart', 'appendseriesvalues', {
			  plotindex : 3,
			  values : [[time4,newValue4]]
			});
			
			setGaugeValue(newValue2,newValue3,newValue4);
		};
		
		//zingchart.exec('myChart', 'update');
		
		ws.onclose = function(event) { 
			console.log('Client notified socket has closed',event); 
		}; 
	}
	</script>
</body>

</html>